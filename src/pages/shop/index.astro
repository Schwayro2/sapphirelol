---
import BaseHead from '../../components/BaseHead.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { SITE_TITLE } from '../../consts';
import { getCollection } from 'astro:content';

let products = [];
try {
  const shopCollection = await getCollection('shop');
  if (shopCollection?.length) {
    products = shopCollection.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
  }
} catch (error) {
  console.error('Error loading products:', error);
}
---

<html lang="en">
  <head>
    <BaseHead title={`${SITE_TITLE} Shop`} description="Premium gaming enhancements and tools" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style is:global>
      /* ... (keep your existing styles here) ... */

      .product-actions {
        display: flex;
        justify-content: center;
        align-items: flex-end;
        gap: 0.7rem;
        margin-top: 1rem;
      }
      .btn.btn-buy {
        background: linear-gradient(90deg, #06b6d4, #6366f1 85%);
        color: #fff;
        font-weight: 700;
        border: none;
        border-radius: 12px;
        padding: 0.8em 2.2em;
        font-size: 1.09rem;
        box-shadow: 0 4px 16px 0 rgba(99,102,241,0.13);
        transition: background 0.18s, transform 0.18s;
        display: flex;
        align-items: center;
        gap: 0.65em;
        cursor: pointer;
        text-decoration: none;
      }
      .btn.btn-buy:hover {
        background: linear-gradient(95deg, #6366f1, #06b6d4 85%);
        transform: translateY(-2px) scale(1.04);
      }
      .btn.btn-secondary {
        background: #fff;
        color: #6366f1;
        border: 1.5px solid #6366f1;
        padding: 0.8em 1.7em;
        border-radius: 12px;
        font-size: 1.01rem;
        font-weight: 600;
        box-shadow: 0 1.5px 8px 0 rgba(99,102,241,0.10);
        transition: background 0.15s, color 0.15s;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 0.5em;
      }
      .btn.btn-secondary:hover {
        background: #6366f1;
        color: #fff;
      }
      .product-badge {
        margin-top: 0.7rem;
        font-size: 0.92em;
        color: #36cfcf;
        background: #f1faff;
        border-radius: 7px;
        display: inline-flex;
        align-items: center;
        gap: 0.35em;
        font-weight: 600;
        padding: 0.23em 0.8em 0.23em 0.57em;
        box-shadow: 0 1.5px 5px 0 rgba(6,182,212,0.04);
      }
      .product-badge .fa-shield-check {
        color: #06b6d4;
        font-size: 1em;
      }
    </style>
  </head>
  <body>
    <Header />
    <main>
      <section class="hero">
        <!-- ...hero code unchanged... -->
      </section>
      <section id="products">
        <h2 class="section-title">Available Products</h2>
        {products.length > 0 && (
          <ul class="products-grid">
            {products.map((product, index) => (
              <li class="product-card" style={`animation-delay:${index * 0.09}s`}>
                <a href={`/shop/${product.id}/`} tabindex="-1" aria-hidden="true" style="display:block;">
                  <img src={product.data.heroImage} alt={product.data.title} class="product-image" />
                  <div>
                    <div class="product-title">
                      <i class={product.data.icon || 'fa-solid fa-box'}></i> {product.data.title}
                    </div>
                    {product.data.price && (
                      <div class="product-price">${product.data.price}</div>
                    )}
                    <p class="product-description">{product.data.description}</p>
                    <div class="product-badge">
                      <i class="fa-solid fa-shield-check"></i> Trusted & Secure
                    </div>
                  </div>
                </a>
                <div class="product-actions">
                  {product.data.buyLink ? (
                    <a
                      href={product.data.buyLink}
                      class="btn btn-buy"
                      target="_blank"
                      rel="noopener"
                    >
                      <i class="fa-solid fa-cart-shopping"></i> Buy Now
                    </a>
                  ) : (
                    <a
                      href={`/shop/${product.id}/`}
                      class="btn btn-buy"
                    >
                      <i class="fa-solid fa-cart-shopping"></i> Buy Now
                    </a>
                  )}
                  <a href={`/shop/${product.id}/`} class="btn btn-secondary">More Info</a>
                </div>
              </li>
            ))}
          </ul>
        )}
        {products.length === 0 && (
          <div class="empty-state">
            <h3>Shop is Empty</h3>
            <p>Our team is working on new drops. Check back soon!</p>
          </div>
        )}
      </section>
    </main>
    <Footer />
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const observer = new window.IntersectionObserver(entries => {
          entries.forEach(entry => {
            if (entry.isIntersecting) entry.target.classList.add('visible');
          });
        }, { threshold: 0.07 });
        document.querySelectorAll('.product-card').forEach(el => observer.observe(el));
      });
    </script>
  </body>
</html>
